---
id: developer-tools
title: 开发者工具
---

import DevToolsOverviewScreenshot from '/img/guides/implementation-guides/devtools-overview.png';
import DevToolsPropertiesScreenshot from '/img/guides/implementation-guides/devtools-properties.png';
import DevToolsLayoutScreenshot from '/img/guides/implementation-guides/devtools-layout.png';
import DevToolsStylesScreenshot from '/img/guides/implementation-guides/devtools-styles.png';
import DevToolsOverriddenStylesScreenshot from '/img/guides/implementation-guides/devtools-overridden-styles.png';
import DevToolsSetterContextMenuScreenshot from '/img/guides/implementation-guides/devtools-setter-contextmenu.png';
import DevToolsEventsScreenshot from '/img/guides/implementation-guides/devtools-events.png';
import DevToolsChangePropertyScreenshot from '/img/guides/implementation-guides/devtools-change-property.gif';
import DevToolsChangeLayoutScreenshot from '/img/guides/implementation-guides/devtools-change-layout.gif';

# 开发者工具

Avalonia 内置了一个开发工具窗口，可以通过在 `Window` 构造函数中调用附加的 `AttachDevTools()` 方法来启用。在程序以 `DEBUG` 模式编译时，默认模板已启用此功能：

```csharp
public partial class MainWindow : Window
{
    public MainWindow()
    {
        InitializeComponent();
    }
}

// in auto-generated by Avalonia.NameGenerator MainWindow.g.cs:
partial class MainWindow
{
    // ...
    public void InitializeComponent(bool loadXaml = true, bool attachDevTools = true)
    {
        // ...
#if DEBUG
        if (attachDevTools)
        {
            this.AttachDevTools();
        }
#endif
        // ...
    }
}
```

要打开开发工具，请按 F12，或者传递不同的 `Gesture` 给 `this.AttachDevTools()` 方法。

:::info
要使用开发工具，必须添加 `Avalonia.Diagnostics` NuGet 包。

```bash
dotnet add package Avalonia.Diagnostics --version 11.0.0
```

但默认情况下，它已经安装好了。
:::

<img className="center" src={DevToolsOverviewScreenshot} alt="" />

在 .NET Core 2.1 下运行时，按 F12 会导致程序退出，这是一个已知问题。在这种情况下，可以选择切换到 .NET Core 2.0 或 3.0 以上版本，或者将打开手势更改为其他的，比如 `Ctrl+F12`。

## 逻辑树和视觉树

`逻辑树` 和 `视觉树` 选项卡显示窗口中逻辑树和视觉树中的控件。选择一个控件后，其属性会显示在右侧窗格中，用户可以在此编辑这些属性。

### 属性

该部分允许快速检查和编辑控件的属性。用户还可以通过名称或使用正则表达式搜索属性。

| 列      | 描述                   |
| ------- | ---------------------- |
| 属性    | 属性的名称             |
| 值      | 属性的当前值           |
| 类型    | 当前值的类型           |
| 优先级  | 值的优先级             |

<img className="center" src={DevToolsPropertiesScreenshot} alt="" />

### 布局

允许检查和编辑常见的布局属性（`Margin`、`Border`、`Padding`）。\
控件的尺寸和尺寸约束也会显示。

:::info
如果 `Width` 或 `Height` 带有下划线，这表明该属性属于活动约束。悬停在值上会显示包含相关信息的工具提示。
:::

<img className="center" src={DevToolsLayoutScreenshot} alt="" />

### 样式

虽然 [属性](developer-tools.md#properties) 面板显示当前活动的属性值，但样式面板显示所有值及其来源。

此外，可以看到所有可能匹配此控件的样式（通过切换 `显示非活动` 选项）。

当前样式可以通过按 `快照` 按钮或在目标窗口上悬停时按 `Alt+S` 来捕捉。捕捉快照意味着样式面板不会更新以反映控件的新状态。这在排查 `:pointerover` 或 `:pressed` 选择器问题时特别有用。

:::info
如果设置器的值绑定到资源，它将由一个圆圈和资源键表示。
:::

<img className="center" src={DevToolsStylesScreenshot} alt="" />

:::info
如果给定值有删除线，表示它被优先级更高的样式值覆盖。
:::

<img className="center" src={DevToolsOverriddenStylesScreenshot} alt="" />

Setters 有一个上下文菜单，允许快速将名称和值复制到剪贴板。

<img className="center" src={DevToolsSetterContextMenuScreenshot} alt="" />

## 事件

事件选项卡可用于跟踪 [事件](../../concepts/input/) 的传播。在左侧窗格中选择要跟踪的事件类型，所有此类型的事件将显示在中上方窗格中。选择其中一个事件以查看事件路由。

:::info
事件名称或控件类型下的虚线表示可以进行快速导航。

* 双击事件类型将选择并滚动到给定的事件类型
* 双击控件类型（和/或名称）将导航到视觉树选项卡并选择该控件。
:::

<img className="center" src={DevToolsEventsScreenshot} alt="" />

## 快捷键

| 键组合          | 功能                            |
| --------------- | ------------------------------ |
| Alt+S           | 启用快照样式                   |
| Alt+D           | 禁用快照样式                   |
| CTRL+Shift      | 检查指针上的控件               |
| CTRL+Alt+F      | 切换弹出窗口冻结               |
| F8              | 对逻辑树或视觉树中选定的项目截图 |

## 示例

### 更改属性值

<img className="center" src={DevToolsChangePropertyScreenshot} alt="" />

### 更改布局属性

<img className="center" src={DevToolsChangeLayoutScreenshot} alt="" />
